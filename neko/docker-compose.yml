services:
  neko:
    build: .
    container_name: neko
    restart: unless-stopped
    shm_size: "2gb"
    cap_add:
      - SYS_ADMIN
    env_file:
      - .env
    environment:
      # Desktop / stream
      NEKO_DESKTOP_SCREEN: "1920x1080@30"

      # WebRTC
      NEKO_EPR: "52000-52100"
      NEKO_ICELITE: "1"
      NEKO_NAT1TO1: "${PUBLIC_IP}"  # Set to your server's public IP

      # Optional quality defaults
      NEKO_CAPTURE_VIDEO_CODEC: "vp8"
      NEKO_AUDIO: "opus"

    ports:
      - "52000-52100:52000-52100/udp"
      - "127.0.0.1:9222:9223"   # socat CDP proxy (container 9223 â†’ Chrome 9222)

    networks:
      - proxy

    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"

      - "traefik.http.routers.neko.rule=Host(`${NEKO_DOMAIN}`)"
      - "traefik.http.routers.neko.entrypoints=websecure"
      - "traefik.http.routers.neko.tls=true"
      - "traefik.http.routers.neko.tls.certresolver=letsencrypt"

      - "traefik.http.services.neko.loadbalancer.server.port=8080"

networks:
  proxy:
    external: true

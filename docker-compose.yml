services:
  neko:
    build: .
    container_name: neko
    restart: unless-stopped
    shm_size: "2gb"
    cap_add:
      - SYS_ADMIN
    env_file:
      - .env

    volumes:
      - chrome-data:/home/neko/.config/google-chrome-cdp

    ports:
      - "52000-52100:52000-52100/udp"
      - "127.0.0.1:9222:9223"   # socat CDP proxy (container 9223 â†’ Chrome 9222)

    networks:
      - proxy

    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"

      - "traefik.http.routers.neko.rule=Host(`${NEKO_DOMAIN}`)"
      - "traefik.http.routers.neko.entrypoints=websecure"
      - "traefik.http.routers.neko.tls=true"
      - "traefik.http.routers.neko.tls.certresolver=letsencrypt"

      - "traefik.http.routers.neko.middlewares=neko-ipwhitelist"
      - "traefik.http.middlewares.neko-ipwhitelist.ipallowlist.sourcerange=YOUR_IP_HERE/32"

      - "traefik.http.services.neko.loadbalancer.server.port=8080"

volumes:
  chrome-data:

networks:
  proxy:
    external: true
